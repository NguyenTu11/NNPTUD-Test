<!DOCTYPE html>
<html>

<head>
  <title>NNPTUD-S5</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
    }

    .main-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      padding: 2rem 2.5rem;
      margin-top: 40px;
      margin-bottom: 40px;
    }

    h1 {
      font-weight: 700;
      letter-spacing: 2px;
      text-align: center;
      background: linear-gradient(90deg, #36d1c4 0%, #5b86e5 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .table thead th {
      text-align: center;
      vertical-align: middle;
    }

    .table tbody td {
      vertical-align: middle;
    }

    .role-table th,
    .role-table td {
      text-align: center;
    }

    @media (max-width: 991px) {
      .main-card {
        padding: 1rem 0.5rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="main-card mx-auto">
      <h1 class="mb-4">Quản lý người dùng &amp; vai trò</h1>

      <!-- Thanh tìm kiếm User -->
      <form class="mb-4" method="get" action="/">
        <div class="row g-2 justify-content-center">
          <div class="col-md-4">
            <input type="text" class="form-control" name="username" placeholder="Tìm theo Username"
              value="<%= typeof username !== 'undefined' ? username : '' %>">
          </div>
          <div class="col-md-4">
            <input type="text" class="form-control" name="fullName" placeholder="Tìm theo Full Name"
              value="<%= typeof fullName !== 'undefined' ? fullName : '' %>">
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
          </div>
        </div>
      </form>

      <!-- Danh sách User -->
      <div class="mb-5">
        <h4 class="mb-3 text-primary text-center">Danh sách User</h4>
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle bg-white shadow-sm">
            <thead class="table-primary">
              <tr>
                <th>Avatar</th>
                <th>Username</th>
                <th>Email</th>
                <th>Full Name</th>
                <th>Role</th>
                <th>Status</th>
                <th>Login Count</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(function(user) { %>
              <tr>
                <td class="text-center">
                  <% if(user.avatarUrl) { %>
                  <img src="<%= user.avatarUrl %>" alt="avatar"
                    style="width:40px;height:40px;object-fit:cover;border-radius:50%;border:1px solid #ccc;">
                  <% } else { %>
                  <span class="text-muted">No avatar</span>
                  <% } %>
                </td>
                <td class="fw-semibold">
                  <%= user.username %>
                </td>
                <td>
                  <%= user.email %>
                </td>
                <td>
                  <%= user.fullName %>
                </td>
                <td>
                  <%= user.role ? user.role.name : '' %>
                </td>
                <td>
                  <% if(user.status) { %>
                  <span class="badge bg-success">Đã xác thực</span>
                  <% } else { %>
                  <span class="badge bg-secondary">Chưa xác thực</span>
                  <% } %>
                </td>
                <td class="text-center">
                  <%= user.loginCount %>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Danh sách Role -->
      <div>
        <h4 class="mb-3 text-info text-center">Danh sách Role</h4>
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle bg-white shadow-sm role-table">
            <thead class="table-info">
              <tr>
                <th>Name</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <% roles.forEach(function(role) { %>
              <tr>
                <td class="fw-semibold">
                  <%= role.name %>
                </td>
                <td>
                  <%= role.description %>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>